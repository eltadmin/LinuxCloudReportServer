# Инструкция по обновлению ключа регистрации для Linux Cloud Report Server

## Введение

Linux Cloud Report Server требует действительный ключ регистрации для запуска. Ключ регистрации генерируется на основе серийного номера оборудования, на котором запускается сервер. В этой инструкции описан процесс генерации и обновления ключа регистрации.

## Генерация нового ключа регистрации

Для генерации нового ключа регистрации используется утилита `key_generator.py`, которая находится в директории `src`. Эта утилита автоматически определяет серийный номер оборудования и генерирует соответствующий ключ.

### Шаги по генерации ключа:

1. Перейдите в директорию с сервером:
   ```bash
   cd LinuxCloudReportServer
   ```

2. Запустите утилиту генерации ключа:
   ```bash
   python src/key_generator.py
   ```

3. Утилита выведет серийный номер оборудования и сгенерированный ключ:
   ```
   Hardware Serial: YOUR-HARDWARE-SERIAL
   Generated Key: YOUR-GENERATED-KEY
   ```

4. Вы можете также сохранить информацию о регистрации в файл:
   ```bash
   python src/key_generator.py --output registration.ini
   ```

### Дополнительные опции:

- Если вы хотите использовать конкретный серийный номер вместо автоматически определенного:
  ```bash
  python src/key_generator.py --serial YOUR-CUSTOM-SERIAL
  ```

## Обновление ключа регистрации в конфигурационном файле

После генерации ключа необходимо обновить конфигурационный файл сервера.

### Шаги по обновлению:

1. Откройте файл конфигурации `config/server.ini`:
   ```bash
   nano config/server.ini
   ```

2. Найдите раздел `[REGISTRATION INFO]` и обновите значения:
   ```ini
   [REGISTRATION INFO]
   SERIAL NUMBER=YOUR-HARDWARE-SERIAL
   KEY=YOUR-GENERATED-KEY
   ```

3. Сохраните изменения в файле и закройте редактор.

## Проверка ключа регистрации

Чтобы убедиться, что ключ регистрации работает правильно, вы можете использовать тестовый скрипт:

```bash
python test_custom_key.py
```

Этот скрипт проверит текущий ключ из файла конфигурации и новый сгенерированный ключ.

## Запуск сервера с новым ключом

После обновления ключа регистрации запустите сервер:

```bash
python src/server.py
```

Если ключ регистрации действителен, сервер успешно запустится и в лог-файле будет сообщение "Registration key validated successfully".

## Устранение неполадок

Если возникают проблемы с ключом регистрации:

1. Убедитесь, что формат ключа правильный и не содержит лишних пробелов
2. Проверьте, что серийный номер в файле конфигурации соответствует тому, что использовался при генерации ключа
3. Ключ должен быть закодирован в Base64 с правильным заполнением (padding)

## Примечания

- Ключ регистрации привязан к конкретному оборудованию. При переносе сервера на другое оборудование необходимо сгенерировать новый ключ.
- Для тестовых целей можно использовать специальный ключ с серийным номером "141298787" и ключом "BszXj0gTaKILS6Ap56=="
- В Docker-контейнере может потребоваться указать серийный номер вручную, так как автоматическое определение может не работать правильно. 